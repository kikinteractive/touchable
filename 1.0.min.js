/**
 * touchable.js v1.0
 * Socket-style finger management for touch events
 * Copyright (c) 2012 Kik Interactive, http://kik.com
 * Released under the MIT license
 *
 * Touchy.js
 * Socket-style finger management for touch events
 * Jairaj Sethi
 * http://creativecommons.org/licenses/by/3.0/
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */

(function(i,B,w,u,x){function k(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a=a.attachEvent("on"+b,c),p[a]={name:b,callback:c})}function l(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)for(var d in p)p[d].name===b&&p[d].callback===c&&(a.detachEvent(d),delete p[d])}function y(a,b){function c(a){var b=Array.prototype.slice.call(arguments,1);if(e[a])return e[a].apply(this,b)}var d=a.prototype,e=b.prototype,g,f;for(f in e)d[f]=e[f];d._super?
(g=d._super,d._super=function(){g.call(this,arguments);c.call(this,arguments)}):d._super=c}function n(){this.onEvents={};this.onceEvents={}}function q(a){this._super("constructor");this.id=a;this.lastPoint=null}function r(a){this._super("constructor");this.fingers=!a?[]:v(a,function(a){return new q(a)})}function o(a,b){return v(a,function(a){return{id:a.identifier,x:a.pageX,y:a.pageY,time:b}})}function s(a,b){return[{id:b,x:a.pageX,y:a.pageY,time:a.timeStamp}]}function f(a,b,c){"undefined"==typeof c&&
(c=b,b=!1);"function"==typeof c&&(c={any:c});for(var d in t)if(d in c){var e=t[d](a,c[d]);"function"==typeof e&&(e={any:e});for(var g in e)c[g]=g in c?function(a,b){return function(){a.call(this,arguments);b.call(this,arguments)}}(c[g],e[g]):e[g]}this.running=!1;this.elem=a;this.handleMouse=!!b;this.settings=c||{};this.mainHand=new r;this.mouseID=this.multiHand=null;this.start()}function m(a,b,c){return new f(a,b,c)}var i=i||{},h;h=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,
b,c)}:function(a,b,c){for(var d=0,e=a.length;d<e;d++)d in a&&b.call(c,a[d],d,a)};var j;j=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){for(var c=c||0,d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1};var v;v=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),g=0;g<d;g++)g in a&&(e[g]=b.call(c,a[g],g,a));return e};var z;z=Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,
b,c)}:function(a,b,c){for(var d=[],e,g=0,f=a.length;g<f;g++)e=a[g],g in a&&b.call(c,e,g,a)&&d.push(e);return d};var p={};n.prototype.on=function(a,b){if(b){if(a in this.onEvents){var c=j(this.onEvents[a],b);if(-1!=c)return}else this.onEvents[a]=[];a in this.onceEvents&&(c=j(this.onceEvents[a],b),-1!=c&&this.onceEvents.splice(c,1));this.onEvents[a].push(b)}};n.prototype.once=function(a,b){if(b){if(a in this.onceEvents){var c=j(this.onceEvents[a],b);if(-1!=c)return}else this.onceEvents[a]=[];a in this.onEvents&&
(c=j(this.onEvents[a],b),-1!=c&&this.onEvents.splice(c,1));this.onceEvents[a].push(b)}};n.prototype.off=function(a,b){if(b){if(a in this.onEvents){var c=j(this.onEvents[a],b);if(-1!=c){this.onEvents.splice(c,1);return}}a in this.onceEvents&&(c=j(this.onceEvents[a],b),-1!=c&&this.onceEvents.splice(c,1))}};n.prototype.trigger=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=(this.onEvents[a]||[]).concat(this.onceEvents[a]||[]),d;d=c.shift();)d.apply(this,b)};y(q,n);y(r,n);r.prototype.get=
function(a){var b;h(this.fingers,function(c){c.id==a&&(b=c)});return b};f.prototype.start=function(){this.running||(this.running=!0,k(this.elem,"touchstart",this.touchstart()),k(this.elem,"touchmove",this.touchmove()),k(this.elem,"touchend",this.touchend()),this.handleMouse&&(k(this.elem,"mousedown",this.mousedown()),k(this.elem,"mouseup",this.mouseup()),k(this.elem,"mousemove",this.mousemove())))};f.prototype.stop=function(){this.running&&(this.running=!1,l(this.elem,"touchstart",this.touchstart()),
l(this.elem,"touchmove",this.touchmove()),l(this.elem,"touchend",this.touchend()),l(this.elem,"mousedown",this.mousedown()),l(this.elem,"mouseup",this.mouseup()),l(this.elem,"mousemove",this.mousemove()))};f.prototype.touchstart=function(){if(!this._touchstart){var a=this;this._touchstart=function(b){var c=o(b.touches,b.timeStamp),b=o(b.changedTouches,b.timeStamp);a.mainHandStart(b);a.multiHandStart(b,c)}}return this._touchstart};f.prototype.touchmove=function(){if(!this._touchmove){var a=this;this._touchmove=
function(b){var c=o(b.touches,b.timeStamp),b=o(b.changedTouches,b.timeStamp);a.mainHandMove(b);a.multiHandMove(b,c)}}return this._touchmove};f.prototype.touchend=function(){if(!this._touchend){var a=this;this._touchend=function(b){var c=o(b.touches,b.timeStamp),b=o(b.changedTouches,b.timeStamp);a.mainHandEnd(b);a.multiHandEnd(b,c)}}return this._touchend};f.prototype.mousedown=function(){if(!this._mousedown){var a=this;this._mousedown=function(b){var c;a.mouseID&&(c=s(b,a.mouseID),a.mainHandEnd(c),
a.multiHandEnd(c,c),a.mouseID=null);a.mouseID=Math.random()+"";c=s(b,a.mouseID);a.mainHandStart(c);a.multiHandStart(c,c)}}return this._mousedown};f.prototype.mouseup=function(){if(!this._mouseup){var a=this;this._mouseup=function(b){a.mouseID&&(b=s(b,a.mouseID),a.mainHandEnd(b),a.multiHandEnd(b,b),a.mouseID=null)}}return this._mouseup};f.prototype.mousemove=function(){if(!this._mousemove){var a=this;this._mousemove=function(b){a.mouseID&&(b=s(b,a.mouseID),a.mainHandMove(b),a.multiHandMove(b,b))}}return this._mousemove};
f.prototype.mainHandStart=function(a){var b=this,c=[];h(a,function(a){var e=new q(a.id);e.lastPoint=a;c.push([e,a]);b.mainHand.fingers.push(e)});h(c,function(a){b.settings.any&&b.settings.any.call(b,b.mainHand,a[0]);a[0].trigger("start",a[1])});b.mainHand.trigger("start",a)};f.prototype.mainHandMove=function(a){var b=this,c=[];h(a,function(a){var e=b.mainHand.get(a.id);e&&(e.lastPoint=a,c.push([e,a]))});h(c,function(a){a[0].trigger("move",a[1])});b.mainHand.trigger("move",a)};f.prototype.mainHandEnd=
function(a){var b=this,c=[];h(a,function(a){var e=b.mainHand.get(a.id);e&&(e.lastPoint=a,c.push([e,a]),a=j(b.mainHand.fingers,e),b.mainHand.fingers.splice(a,1))});h(c,function(a){a[0].trigger("end",a[1])});b.mainHand.trigger("end",a)};f.prototype.multiHandStart=function(a,b){this.multiHandDestroy();this.multiHandRestart(b)};f.prototype.multiHandMove=function(a){var b=this,c=[];h(a,function(a){var e=b.multiHand.get(a.id);e&&(e.lastPoint=a,c.push([e,a]))});h(c,function(a){a[0].trigger("move",a[1])});
b.multiHand.trigger("move",a)};f.prototype.multiHandEnd=function(a,b){this.multiHandDestroy();var c=z(b,function(b){var c=!0;h(a,function(a){a.id==b.id&&(c=!1)});return c});this.multiHandRestart(c)};f.prototype.multiHandRestart=function(a){var b=this;if(0!=a.length){b.multiHand=new r;var c=[];h(a,function(a){var d=new q(a.id);d.lastPoint=a;c.push([d,a]);b.multiHand.fingers.push(d)});var d=b.settings[{1:"one",2:"two",3:"three",4:"four",5:"five"}[b.multiHand.fingers.length]];d&&d.apply(b,[b.multiHand].concat(b.multiHand.fingers));
h(c,function(a){a[0].trigger("start",a[1])});b.multiHand.trigger("start",a)}};f.prototype.multiHandDestroy=function(){if(this.multiHand){var a=[];h(this.multiHand.fingers,function(b){var c=b.lastPoint;a.push(c);b.trigger("end",c)});this.multiHand.trigger("end",a);this.multiHand=null}};var t={};m.plugin=function(a,b){if(a in t)throw"Touchable: "+a+" plugin already defined";t[a]=b};var A=function(a){a.preventDefault()};m.stopWindowBounce=function(){k(i,"touchmove",A)};m.startWindowBounce=function(){l(i,
"touchmove",A)};i.Touchable=m;w&&w.plugin("touchable",function(){m.apply(i,arguments)});u&&u.extend(u.fn,{touchable:function(){var a=Array.prototype.slice.call(arguments);this.forEach(function(){var b=a.slice();b.unshift(this);m.apply(i,b)});return this}});x&&(x.fn.touchable=function(){var a=Array.prototype.slice.call(arguments);this.each(function(){var b=a.slice();b.unshift(this);m.apply(i,b)})})})(window,document,window.clik,window.Zepto,window.jQuery);
